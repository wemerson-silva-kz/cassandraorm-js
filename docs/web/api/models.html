<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Operations - CassandraORM JS</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-database"></i>
                <span>CassandraORM JS</span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">‚Üê API Docs</a></li>
                <li><a href="../index.html">Home</a></li>
                <li><a href="https://github.com/wemerson-silva-kz/cassandraorm-js" target="_blank">GitHub</a></li>
            </ul>
        </div>
    </nav>

    <main class="example-page">
        <div class="container">
            <h1>üíæ Model Operations</h1>
            <p class="example-description">
                CRUD operations, batch processing, and data manipulation methods.
            </p>

            <div class="example-section">
                <h2>üìù Create Operations</h2>
                <h3>save(data, options)</h3>
                <pre><code class="language-javascript">// Simple save
const user = await User.save({
  name: 'John Doe',
  email: 'john@example.com',
  age: 30
});

// Save with options
const user = await User.save({
  name: 'Jane Doe',
  email: 'jane@example.com'
}, {
  ttl: 3600,        // 1 hour TTL
  ifNotExists: true // Only insert if doesn't exist
});

// Save with custom timestamp
const user = await User.save({
  name: 'Bob Smith',
  email: 'bob@example.com'
}, {
  timestamp: new Date('2024-01-01')
});</code></pre>

                <h3>create(data)</h3>
                <pre><code class="language-javascript">// Alias for save with validation
const user = await User.create({
  name: 'Alice Johnson',
  email: 'alice@example.com',
  age: 25
});</code></pre>
            </div>

            <div class="example-section">
                <h2>üîç Read Operations</h2>
                <h3>find(filter, options)</h3>
                <pre><code class="language-javascript">// Find all users
const users = await User.find();

// Find with filter
const activeUsers = await User.find({ status: 'active' });

// Find with complex filter
const users = await User.find({
  age: { $gte: 18, $lte: 65 },
  department: { $in: ['engineering', 'design'] }
});

// Find with options
const users = await User.find({ status: 'active' }, {
  limit: 10,
  orderBy: { created_at: 'desc' },
  select: ['id', 'name', 'email'],
  include: ['profile', 'posts']
});</code></pre>

                <h3>findOne(filter, options)</h3>
                <pre><code class="language-javascript">// Find by primary key
const user = await User.findOne({ id: userId });

// Find with filter
const user = await User.findOne({ email: 'john@example.com' });

// Find with relations
const user = await User.findOne({ id: userId }, {
  include: ['posts', 'profile']
});</code></pre>

                <h3>findById(id, options)</h3>
                <pre><code class="language-javascript">// Simple find by ID
const user = await User.findById(userId);

// Find by ID with relations
const user = await User.findById(userId, {
  include: ['posts']
});</code></pre>

                <h3>count(filter)</h3>
                <pre><code class="language-javascript">// Count all records
const totalUsers = await User.count();

// Count with filter
const activeUsers = await User.count({ status: 'active' });</code></pre>
            </div>

            <div class="example-section">
                <h2>‚úèÔ∏è Update Operations</h2>
                <h3>update(filter, data, options)</h3>
                <pre><code class="language-javascript">// Update by primary key
await User.update({ id: userId }, {
  name: 'John Updated',
  updated_at: new Date()
});

// Update with conditions
await User.update({ id: userId }, {
  status: 'inactive'
}, {
  ifExists: true,
  ttl: 7200
});

// Conditional update
await User.update({ id: userId }, {
  login_count: { $inc: 1 },
  last_login: new Date()
}, {
  if: { status: 'active' }
});</code></pre>

                <h3>updateById(id, data, options)</h3>
                <pre><code class="language-javascript">// Update by ID
await User.updateById(userId, {
  name: 'Updated Name',
  email: 'new@example.com'
});</code></pre>

                <h3>upsert(filter, data, options)</h3>
                <pre><code class="language-javascript">// Insert or update
const user = await User.upsert({ email: 'john@example.com' }, {
  name: 'John Doe',
  age: 30,
  updated_at: new Date()
});</code></pre>
            </div>

            <div class="example-section">
                <h2>üóëÔ∏è Delete Operations</h2>
                <h3>delete(filter, options)</h3>
                <pre><code class="language-javascript">// Delete by primary key
await User.delete({ id: userId });

// Soft delete (if enabled)
await User.delete({ id: userId }, { soft: true });

// Delete with conditions
await User.delete({ id: userId }, {
  if: { status: 'inactive' }
});</code></pre>

                <h3>deleteById(id, options)</h3>
                <pre><code class="language-javascript">// Delete by ID
await User.deleteById(userId);

// Soft delete by ID
await User.deleteById(userId, { soft: true });</code></pre>

                <h3>truncate()</h3>
                <pre><code class="language-javascript">// Remove all records (use with caution)
await User.truncate();</code></pre>
            </div>

            <div class="example-section">
                <h2>üì¶ Batch Operations</h2>
                <pre><code class="language-javascript">// Create batch
const batch = client.batch();

// Add operations to batch
batch.insert('users', { id: uuid(), name: 'User 1', email: 'user1@example.com' });
batch.insert('users', { id: uuid(), name: 'User 2', email: 'user2@example.com' });
batch.update('users', { id: existingUserId }, { name: 'Updated User' });
batch.delete('users', { id: oldUserId });

// Execute batch
await batch.execute();

// Model-level batch operations
const users = [
  { name: 'User 1', email: 'user1@example.com' },
  { name: 'User 2', email: 'user2@example.com' },
  { name: 'User 3', email: 'user3@example.com' }
];

// Batch insert
await User.batchInsert(users);

// Batch update
await User.batchUpdate([
  { filter: { id: userId1 }, data: { name: 'Updated 1' } },
  { filter: { id: userId2 }, data: { name: 'Updated 2' } }
]);

// Batch delete
await User.batchDelete([
  { id: userId1 },
  { id: userId2 }
]);</code></pre>
            </div>

            <div class="example-section">
                <h2>üîÑ Streaming Operations</h2>
                <pre><code class="language-javascript">// Stream large datasets
const stream = User.stream({ status: 'active' });

stream.on('data', (user) => {
  console.log('Processing user:', user.name);
  // Process each user individually
});

stream.on('end', () => {
  console.log('Finished processing all users');
});

stream.on('error', (error) => {
  console.error('Stream error:', error);
});

// Async iteration
for await (const user of User.stream({ department: 'engineering' })) {
  console.log('User:', user.name);
  // Process user
}</code></pre>
            </div>

            <div class="example-section">
                <h2>üìä Aggregation Operations</h2>
                <pre><code class="language-javascript">// Count by group
const departmentCounts = await User.aggregate([
  { $match: { status: 'active' } },
  { $groupBy: 'department' },
  { $count: 'total_users' }
]);

// Sum and average
const stats = await Order.aggregate([
  { $match: { status: 'completed' } },
  { $groupBy: 'customer_id' },
  { $sum: { field: 'amount', as: 'total_spent' } },
  { $avg: { field: 'amount', as: 'avg_order' } },
  { $count: 'order_count' }
]);

// Time-based aggregations
const dailyStats = await Event.aggregate([
  { $match: { created_at: { $gte: new Date('2024-01-01') } } },
  { $groupBy: { $dateFormat: { field: 'created_at', format: '%Y-%m-%d' } } },
  { $count: 'events_per_day' }
]);</code></pre>
            </div>

            <div class="api-nav-footer">
                <div class="nav-links">
                    <a href="schema.html" class="btn">‚Üê Schema Definition</a>
                    <a href="query-builder.html" class="btn btn-primary">Query Builder ‚Üí</a>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
