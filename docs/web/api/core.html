<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core API - CassandraORM JS</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-database"></i>
                <span>CassandraORM JS</span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">‚Üê API Docs</a></li>
                <li><a href="../index.html">Home</a></li>
                <li><a href="https://github.com/wemerson-silva-kz/cassandraorm-js" target="_blank">GitHub</a></li>
            </ul>
        </div>
    </nav>

    <main class="example-page">
        <div class="container">
            <h1>üîå Core API</h1>
            <p class="example-description">
                Client creation, connection management, and basic database operations.
            </p>

            <div class="example-section">
                <h2>üìã createClient(options)</h2>
                <p>Creates a new CassandraORM client instance.</p>
                <pre><code class="language-javascript">import { createClient } from 'cassandraorm-js';

const client = createClient({
  clientOptions: {
    contactPoints: ['127.0.0.1', '127.0.0.2'],
    localDataCenter: 'datacenter1',
    keyspace: 'myapp',
    credentials: {
      username: 'cassandra',
      password: 'cassandra'
    },
    pooling: {
      coreConnectionsPerHost: {
        [distance.local]: 2,
        [distance.remote]: 1
      }
    }
  },
  ormOptions: {
    createKeyspace: true,
    migration: 'safe', // 'safe' | 'alter' | 'drop'
    defaultReplication: {
      class: 'SimpleStrategy',
      replication_factor: 3
    }
  }
});</code></pre>

                <h3>Parameters</h3>
                <table class="api-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>clientOptions</code></td>
                            <td>Object</td>
                            <td>Cassandra driver options</td>
                        </tr>
                        <tr>
                            <td><code>ormOptions</code></td>
                            <td>Object</td>
                            <td>ORM-specific configuration</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="example-section">
                <h2>üîó Client Methods</h2>
                
                <h3>connect()</h3>
                <p>Establishes connection to Cassandra cluster.</p>
                <pre><code class="language-javascript">await client.connect();
console.log('Connected to Cassandra');</code></pre>

                <h3>disconnect()</h3>
                <p>Closes all connections to the cluster.</p>
                <pre><code class="language-javascript">await client.disconnect();
console.log('Disconnected from Cassandra');</code></pre>

                <h3>execute(query, params, options)</h3>
                <p>Executes a CQL query directly.</p>
                <pre><code class="language-javascript">const result = await client.execute(
  'SELECT * FROM users WHERE id = ?',
  [userId],
  { prepare: true }
);

console.log('Rows:', result.rows);
console.log('Row count:', result.rowLength);</code></pre>

                <h3>batch()</h3>
                <p>Creates a new batch operation.</p>
                <pre><code class="language-javascript">const batch = client.batch();
batch.insert('users', { id: uuid(), name: 'John' });
batch.update('users', { id: userId }, { name: 'Jane' });
batch.delete('users', { id: oldUserId });

await batch.execute();
console.log('Batch executed successfully');</code></pre>

                <h3>loadSchema(tableName, schema)</h3>
                <p>Loads and creates a model from schema definition.</p>
                <pre><code class="language-javascript">const User = await client.loadSchema('users', {
  fields: {
    id: { type: 'uuid', primary: true },
    name: { type: 'text', validate: { required: true } },
    email: { type: 'text', unique: true },
    created_at: { type: 'timestamp', default: () => new Date() }
  },
  key: ['id'],
  indexes: ['email'],
  options: {
    clustering_order: { created_at: 'desc' }
  }
});

// Model is now ready for use
const user = await User.save({ name: 'John', email: 'john@example.com' });</code></pre>
            </div>

            <div class="example-section">
                <h2>‚öôÔ∏è Configuration Options</h2>
                
                <h3>Client Options</h3>
                <pre><code class="language-javascript">const clientOptions = {
  // Connection
  contactPoints: ['127.0.0.1'],
  localDataCenter: 'datacenter1',
  keyspace: 'myapp',
  
  // Authentication
  credentials: {
    username: 'cassandra',
    password: 'cassandra'
  },
  
  // SSL/TLS
  sslOptions: {
    rejectUnauthorized: false,
    cert: fs.readFileSync('client-cert.pem'),
    key: fs.readFileSync('client-key.pem'),
    ca: [fs.readFileSync('ca-cert.pem')]
  },
  
  // Connection Pooling
  pooling: {
    coreConnectionsPerHost: {
      [distance.local]: 4,
      [distance.remote]: 2
    },
    maxConnectionsPerHost: {
      [distance.local]: 8,
      [distance.remote]: 4
    }
  },
  
  // Policies
  policies: {
    loadBalancing: new DCAwareRoundRobinPolicy('datacenter1'),
    retry: new RetryPolicy(),
    reconnection: new ExponentialReconnectionPolicy(1000, 10 * 60 * 1000)
  },
  
  // Query Options
  queryOptions: {
    prepare: true,
    consistency: consistency.localQuorum,
    fetchSize: 5000
  }
};</code></pre>

                <h3>ORM Options</h3>
                <pre><code class="language-javascript">const ormOptions = {
  // Keyspace Management
  createKeyspace: true,
  migration: 'safe', // 'safe' | 'alter' | 'drop'
  
  // Replication Strategy
  defaultReplication: {
    class: 'NetworkTopologyStrategy',
    datacenter1: 3,
    datacenter2: 2
  },
  
  // Model Options
  defaultModelOptions: {
    timestamps: true, // Add created_at, updated_at
    softDelete: false, // Enable soft deletes
    validation: true   // Enable field validation
  },
  
  // Performance
  enableCache: true,
  cacheSize: 10000,
  enableMetrics: true,
  
  // Development
  debug: process.env.NODE_ENV === 'development',
  logQueries: true
};</code></pre>
            </div>

            <div class="example-section">
                <h2>üîç Connection State</h2>
                <pre><code class="language-javascript">// Check connection status
const isConnected = client.isConnected();
console.log('Connected:', isConnected);

// Get cluster metadata
const metadata = client.getMetadata();
console.log('Keyspaces:', metadata.keyspaces);
console.log('Hosts:', metadata.getAllHosts());

// Get connection state
const state = client.getState();
console.log('Connected hosts:', state.getConnectedHosts());
console.log('Open connections:', state.getOpenConnections());</code></pre>
            </div>

            <div class="example-section">
                <h2>üìä Health Checks</h2>
                <pre><code class="language-javascript">// Basic health check
const isHealthy = await client.healthCheck();
console.log('Cluster healthy:', isHealthy);

// Detailed health check
const healthStatus = await client.detailedHealthCheck();
console.log('Health status:', healthStatus);
/*
{
  healthy: true,
  hosts: [
    { address: '127.0.0.1', status: 'UP', responseTime: 2 },
    { address: '127.0.0.2', status: 'UP', responseTime: 3 }
  ],
  keyspace: 'myapp',
  totalHosts: 2,
  activeHosts: 2
}
*/</code></pre>
            </div>

            <div class="example-section">
                <h2>üö® Error Handling</h2>
                <pre><code class="language-javascript">try {
  await client.connect();
} catch (error) {
  if (error.code === 'ENOTFOUND') {
    console.error('Cannot resolve Cassandra host');
  } else if (error.code === 'ECONNREFUSED') {
    console.error('Connection refused by Cassandra');
  } else if (error instanceof cassandra.errors.AuthenticationError) {
    console.error('Authentication failed');
  } else if (error instanceof cassandra.errors.NoHostAvailableError) {
    console.error('No Cassandra hosts available');
  } else {
    console.error('Connection error:', error.message);
  }
}

// Query error handling
try {
  const result = await client.execute('INVALID CQL');
} catch (error) {
  if (error instanceof cassandra.errors.ResponseError) {
    console.error('CQL Error:', error.message);
    console.error('Error code:', error.code);
  }
}</code></pre>
            </div>

            <div class="api-nav-footer">
                <div class="nav-links">
                    <a href="index.html" class="btn">‚Üê API Overview</a>
                    <a href="schema.html" class="btn btn-primary">Schema Definition ‚Üí</a>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
