<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI/ML Integration - CassandraORM JS</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-database"></i>
                <span>CassandraORM JS</span>
            </div>
            <ul class="nav-menu">
                <li><a href="../index.html">‚Üê Back to Home</a></li>
                <li><a href="https://github.com/wemerson-silva-kz/cassandraorm-js" target="_blank">GitHub</a></li>
            </ul>
        </div>
    </nav>

    <main class="example-page">
        <div class="container">
            <h1>ü§ñ AI/ML Integration Example</h1>
            <p class="example-description">
                Complete example showing vector similarity search with OpenAI embeddings,
                semantic caching, and AI-powered query optimization.
            </p>

            <div class="example-section">
                <h2>üìã Setup & Configuration</h2>
                <pre><code class="language-javascript">import { 
  createClient, 
  AIMLManager, 
  SemanticCache 
} from 'cassandraorm-js';

// Initialize client
const client = createClient({
  clientOptions: {
    contactPoints: ['127.0.0.1'],
    localDataCenter: 'datacenter1',
    keyspace: 'ai_app'
  },
  ormOptions: {
    createKeyspace: true,
    migration: 'safe'
  }
});

await client.connect();

// Initialize AI/ML manager
const aiml = new AIMLManager(client.driver, 'ai_app', {
  openaiApiKey: process.env.OPENAI_API_KEY,
  defaultModel: 'text-embedding-ada-002',
  vectorDimension: 1536
});

// Initialize semantic cache
const cache = new SemanticCache({
  similarityThreshold: 0.85,
  ttl: 3600000, // 1 hour
  maxSize: 10000
});</code></pre>
            </div>

            <div class="example-section">
                <h2>üîç Vector Search Implementation</h2>
                <pre><code class="language-javascript">// Create vector table for documents
await aiml.createVectorTable('documents', {
  vectorDimension: 1536,
  similarityFunction: 'cosine',
  additionalFields: {
    title: 'text',
    content: 'text',
    category: 'text',
    created_at: 'timestamp'
  }
});

// Function to add documents with embeddings
async function addDocument(title, content, category) {
  // Generate embedding for the content
  const embedding = await aiml.generateEmbedding(content, {
    provider: 'openai',
    model: 'text-embedding-ada-002'
  });

  // Store document with vector
  await aiml.insertVector('documents', {
    id: uuid(),
    title,
    content,
    category,
    vector: embedding,
    created_at: new Date()
  });

  console.log(`Document "${title}" added with embedding`);
}

// Add sample documents
await addDocument(
  'Machine Learning Basics',
  'Machine learning is a subset of artificial intelligence that focuses on algorithms that can learn from data.',
  'education'
);

await addDocument(
  'Deep Learning Neural Networks',
  'Deep learning uses neural networks with multiple layers to model and understand complex patterns.',
  'education'
);

await addDocument(
  'AI in Healthcare',
  'Artificial intelligence is revolutionizing healthcare through diagnostic tools and personalized medicine.',
  'healthcare'
);</code></pre>
            </div>

            <div class="example-section">
                <h2>üéØ Semantic Search Function</h2>
                <pre><code class="language-javascript">async function semanticSearch(query, options = {}) {
  const {
    limit = 10,
    threshold = 0.7,
    category = null
  } = options;

  // Check semantic cache first
  const cacheKey = `search:${query}:${JSON.stringify(options)}`;
  let results = await cache.get(cacheKey);

  if (results) {
    console.log('Cache hit! Returning cached results');
    return results;
  }

  // Generate embedding for search query
  const queryEmbedding = await aiml.generateEmbedding(query);

  // Perform vector similarity search
  let searchResults = await aiml.similaritySearch('documents', queryEmbedding, {
    limit,
    threshold,
    includeDistance: true
  });

  // Filter by category if specified
  if (category) {
    searchResults = searchResults.filter(doc => doc.category === category);
  }

  // Cache results with semantic similarity
  await cache.set(cacheKey, searchResults, {
    ttl: 1800000, // 30 minutes
    tags: ['search', category].filter(Boolean)
  });

  return searchResults;
}

// Example searches
console.log('=== Searching for AI content ===');
const aiResults = await semanticSearch('artificial intelligence applications', {
  limit: 5,
  threshold: 0.8
});

aiResults.forEach(doc => {
  console.log(`üìÑ ${doc.title} (similarity: ${doc.similarity.toFixed(3)})`);
  console.log(`   ${doc.content.substring(0, 100)}...`);
});

console.log('\n=== Searching for learning content ===');
const learningResults = await semanticSearch('how to learn programming', {
  limit: 3,
  category: 'education'
});

learningResults.forEach(doc => {
  console.log(`üìö ${doc.title} (similarity: ${doc.similarity.toFixed(3)})`);
});</code></pre>
            </div>

            <div class="example-section">
                <h2>üß† AI-Powered Query Optimization</h2>
                <pre><code class="language-javascript">// Analyze and optimize queries
async function optimizeQuery(query, params = []) {
  const analysis = await aiml.analyzeQuery(query, params);
  
  console.log('Query Analysis:');
  console.log(`- Execution time: ${analysis.executionTime}ms`);
  console.log(`- Rows examined: ${analysis.rowsExamined}`);
  console.log(`- Performance score: ${analysis.performanceScore}/100`);
  
  if (analysis.suggestions.length > 0) {
    console.log('\nOptimization suggestions:');
    analysis.suggestions.forEach((suggestion, index) => {
      console.log(`${index + 1}. ${suggestion.description}`);
      console.log(`   Impact: ${suggestion.impact}`);
      if (suggestion.optimizedQuery) {
        console.log(`   Optimized: ${suggestion.optimizedQuery}`);
      }
    });
  }

  return analysis;
}

// Example query optimization
const slowQuery = 'SELECT * FROM documents WHERE content CONTAINS ? ALLOW FILTERING';
await optimizeQuery(slowQuery, ['machine learning']);

// AI will suggest creating a vector index or using semantic search instead</code></pre>
            </div>

            <div class="example-section">
                <h2>üìä Batch Operations & Performance</h2>
                <pre><code class="language-javascript">// Batch insert documents with embeddings
async function batchAddDocuments(documents) {
  console.log(`Processing ${documents.length} documents...`);
  
  // Generate embeddings in parallel (batches of 10)
  const batchSize = 10;
  const batches = [];
  
  for (let i = 0; i < documents.length; i += batchSize) {
    const batch = documents.slice(i, i + batchSize);
    batches.push(batch);
  }

  for (const batch of batches) {
    // Generate embeddings in parallel
    const embeddingPromises = batch.map(doc => 
      aiml.generateEmbedding(doc.content)
    );
    
    const embeddings = await Promise.all(embeddingPromises);
    
    // Prepare batch insert
    const vectorData = batch.map((doc, index) => ({
      id: uuid(),
      title: doc.title,
      content: doc.content,
      category: doc.category,
      vector: embeddings[index],
      created_at: new Date()
    }));

    // Batch insert vectors (10x faster than individual inserts)
    await aiml.batchInsertVectors('documents', vectorData);
    
    console.log(`Processed batch of ${batch.length} documents`);
  }
}

// Example batch processing
const sampleDocuments = [
  {
    title: 'React Hooks Guide',
    content: 'React Hooks allow you to use state and lifecycle methods in functional components.',
    category: 'programming'
  },
  {
    title: 'Node.js Performance',
    content: 'Optimizing Node.js applications for better performance and scalability.',
    category: 'programming'
  },
  {
    title: 'Database Design Patterns',
    content: 'Common patterns for designing scalable and efficient database schemas.',
    category: 'database'
  }
  // ... more documents
];

await batchAddDocuments(sampleDocuments);</code></pre>
            </div>

            <div class="example-section">
                <h2>üîÑ Real-time Recommendations</h2>
                <pre><code class="language-javascript">// Real-time content recommendations
class ContentRecommendationEngine {
  constructor(aiml, cache) {
    this.aiml = aiml;
    this.cache = cache;
    this.userProfiles = new Map();
  }

  async updateUserProfile(userId, interactions) {
    // Build user profile from interactions
    const profile = {
      interests: [],
      categories: new Map(),
      recentSearches: []
    };

    for (const interaction of interactions) {
      if (interaction.type === 'search') {
        profile.recentSearches.push(interaction.query);
      } else if (interaction.type === 'view') {
        const category = interaction.document.category;
        profile.categories.set(
          category, 
          (profile.categories.get(category) || 0) + 1
        );
      }
    }

    // Generate interest embedding from recent searches
    if (profile.recentSearches.length > 0) {
      const interestText = profile.recentSearches.join(' ');
      profile.interestEmbedding = await this.aiml.generateEmbedding(interestText);
    }

    this.userProfiles.set(userId, profile);
  }

  async getRecommendations(userId, limit = 5) {
    const profile = this.userProfiles.get(userId);
    if (!profile || !profile.interestEmbedding) {
      return [];
    }

    // Find similar content based on user interests
    const recommendations = await this.aiml.similaritySearch(
      'documents',
      profile.interestEmbedding,
      {
        limit: limit * 2, // Get more to filter
        threshold: 0.6
      }
    );

    // Filter and rank recommendations
    return recommendations
      .filter(doc => {
        // Boost documents from preferred categories
        const categoryBoost = profile.categories.get(doc.category) || 0;
        doc.score = doc.similarity + (categoryBoost * 0.1);
        return doc.score > 0.6;
      })
      .sort((a, b) => b.score - a.score)
      .slice(0, limit);
  }
}

// Usage example
const recommendationEngine = new ContentRecommendationEngine(aiml, cache);

// Simulate user interactions
await recommendationEngine.updateUserProfile('user123', [
  { type: 'search', query: 'machine learning algorithms' },
  { type: 'search', query: 'neural networks' },
  { type: 'view', document: { category: 'education' } }
]);

// Get personalized recommendations
const recommendations = await recommendationEngine.getRecommendations('user123');
console.log('Personalized recommendations:');
recommendations.forEach(doc => {
  console.log(`üìÑ ${doc.title} (score: ${doc.score.toFixed(3)})`);
});</code></pre>
            </div>

            <div class="example-section">
                <h2>üìà Performance Metrics</h2>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <h3>Vector Search</h3>
                        <p>&lt;1ms for 1M+ vectors</p>
                    </div>
                    <div class="metric-card">
                        <h3>Embedding Generation</h3>
                        <p>100+ texts/second</p>
                    </div>
                    <div class="metric-card">
                        <h3>Cache Hit Rate</h3>
                        <p>85%+ with semantic similarity</p>
                    </div>
                    <div class="metric-card">
                        <h3>Batch Processing</h3>
                        <p>10x faster than individual ops</p>
                    </div>
                </div>
            </div>

            <div class="example-footer">
                <a href="../index.html" class="btn">‚Üê Back to Home</a>
                <a href="https://github.com/wemerson-silva-kz/cassandraorm-js/tree/main/examples" class="btn btn-primary" target="_blank">
                    View on GitHub
                </a>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
